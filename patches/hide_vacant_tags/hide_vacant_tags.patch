From 36858035cdf73f08d94d80bf4aa4251200f5ac80 Mon Sep 17 00:00:00 2001
From: sewn <sewn@disroot.org>
Date: Mon, 10 Jun 2024 14:50:07 +0300
Subject: [PATCH] hide vacant tags

https://dwm.suckless.org/patches/hide_vacant_tags/
---
 dwl.c | 17 +++++++++++++----
 1 file changed, 13 insertions(+), 4 deletions(-)

diff --git a/dwl.c b/dwl.c
index 9fdddc7..2b068ce 100644
--- a/dwl.c
+++ b/dwl.c
@@ -675,7 +675,7 @@ buffer_end_data_ptr_access(struct wlr_buffer *buffer)
 void
 buttonpress(struct wl_listener *listener, void *data)
 {
-	unsigned int i = 0, x = 0;
+	unsigned int i = 0, x = 0, occ = 0;
 	unsigned int click;
 	struct wlr_pointer_button_event *event = data;
 	struct wlr_keyboard *keyboard;
@@ -699,9 +699,16 @@ buttonpress(struct wl_listener *listener, void *data)
 		cursor->x *= selmon->wlr_output->scale;
 		cursor->y *= selmon->wlr_output->scale;
 		x = selmon->m.x;
-		do
+		wl_list_for_each(c, &clients, link) {
+			if (c->mon != selmon)
+				continue;
+			occ |= c->tags == TAGMASK ? 0 : c->tags;
+		}
+		do {
+			if (!(occ & 1 << i || selmon->tagset[selmon->seltags] & 1 << i))
+				continue;
 			x += TEXTW(selmon, tags[i]);
-		while (cursor->x >= x && ++i < LENGTH(tags));
+		} while (cursor->x >= x && ++i < LENGTH(tags));
 		if (i < LENGTH(tags)) {
 			click = ClkTagBar;
 			arg.ui = 1 << i;
@@ -1456,13 +1463,15 @@ drawbar(Monitor *m)
 	wl_list_for_each(c, &clients, link) {
 		if (c->mon != m)
 			continue;
-		occ |= c->tags;
+		occ |= c->tags == TAGMASK ? 0 : c->tags;
 		if (c->isurgent)
 			urg |= c->tags;
 	}
 	x = 0;
 	c = focustop(m);
 	for (i = 0; i < LENGTH(tags); i++) {
+		if(!(occ & 1 << i || m->tagset[m->seltags] & 1 << i))
+			continue;
 		w = TEXTW(m, tags[i]);
 		drwl_setscheme(m->drw, colors[m->tagset[m->seltags] & 1 << i ? SchemeSel : SchemeNorm]);
 		drwl_text(m->drw, x, 0, w, m->b.height, m->lrpad / 2, tags[i], urg & 1 << i);
-- 
2.45.2

